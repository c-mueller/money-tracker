{{define "content"}}
{{template "household_header" .}}

<h2>Settings</h2>

<form method="POST" action="/households/{{.Household.ID}}/settings" class="mt-3" style="max-width: 500px;">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{.Household.Name}}" required maxlength="100">
    </div>
    <div class="mb-3">
        <label for="currency-select" class="form-label">Currency</label>
        <select class="form-select" id="currency-select" name="currency">
            {{$current := .Household.Currency}}
            {{$currencies := .Currencies}}
            {{range .Currencies}}
            <option value="{{.Code}}" {{if eq .Code $current}}selected{{end}}>{{.Code}} ({{.Symbol}}) — {{.Label}}</option>
            {{end}}
            <option value="CUSTOM" {{if not (isCurrencyCode $current $currencies)}}selected{{end}}>Custom…</option>
        </select>
        <input type="text" class="form-control mt-2 {{if isCurrencyCode $current $currencies}}d-none{{end}}" id="currency-custom" maxlength="3" pattern="[A-Z]{3}" placeholder="e.g. TRY" value="{{if not (isCurrencyCode $current $currencies)}}{{$current}}{{end}}">
    </div>

    {{template "icon_picker" dict "SelectedIcon" .Household.Icon "Icons" .Icons}}

    <button type="submit" class="btn btn-primary">Save</button>
</form>

<hr class="mt-4">

<h3 class="text-danger">Danger Zone</h3>
<button class="btn btn-outline-danger btn-sm" data-confirm="Delete this household and all its data?" data-action="/api/v1/households/{{.Household.ID}}" data-method="DELETE" data-redirect="/">Delete Household</button>

<script>
(function() {
    var sel = document.getElementById('currency-select');
    var custom = document.getElementById('currency-custom');

    function toggle() {
        if (sel.value === 'CUSTOM') {
            custom.classList.remove('d-none');
            custom.setAttribute('name', 'currency');
            custom.required = true;
            sel.removeAttribute('name');
        } else {
            custom.classList.add('d-none');
            custom.removeAttribute('name');
            custom.required = false;
            sel.setAttribute('name', 'currency');
        }
    }

    sel.addEventListener('change', toggle);
    toggle();
})();
</script>
{{end}}
