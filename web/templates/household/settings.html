{{define "content"}}
{{template "household_header" .}}

<h2>Household</h2>

<form method="POST" action="/households/{{.Household.ID}}/settings" class="mt-3" style="max-width: 500px;">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{.Household.Name}}" required maxlength="100">
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" rows="2" maxlength="500">{{.Household.Description}}</textarea>
    </div>
    <div class="mb-3">
        <label for="currency-select" class="form-label">Currency</label>
        <select class="form-select" id="currency-select" name="currency">
            {{$current := .Household.Currency}}
            {{$currencies := .Currencies}}
            {{range .Currencies}}
            <option value="{{.Code}}" {{if eq .Code $current}}selected{{end}}>{{.Code}} ({{.Symbol}}) — {{.Label}}</option>
            {{end}}
            <option value="CUSTOM" {{if not (isCurrencyCode $current $currencies)}}selected{{end}}>Custom…</option>
        </select>
        <input type="text" class="form-control mt-2 {{if isCurrencyCode $current $currencies}}d-none{{end}}" id="currency-custom" maxlength="3" pattern="[A-Z]{3}" placeholder="e.g. TRY" value="{{if not (isCurrencyCode $current $currencies)}}{{$current}}{{end}}">
    </div>

    {{template "icon_picker" dict "SelectedIcon" .Household.Icon "Icons" .Icons}}

    <button type="submit" class="btn btn-primary">Save</button>
</form>

<hr class="mt-4">

<h2>Categories</h2>

<form method="POST" action="/households/{{.Household.ID}}/categories" class="mb-4 d-flex gap-2" style="max-width: 400px;">
    <input type="text" class="form-control" name="name" placeholder="New category name" required maxlength="50">
    <button type="submit" class="btn btn-primary">Add</button>
</form>

{{if not .Categories}}
<p class="text-muted">No categories yet.</p>
{{else}}
<table class="table">
    <thead>
        <tr>
            <th>Name</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        {{range .Categories}}
        <tr>
            <td>
                <span class="material-symbols-outlined align-middle me-1">{{.Icon}}</span>{{.Name}}
            </td>
            <td class="text-end text-nowrap">
                <a href="/households/{{$.Household.ID}}/categories/{{.ID}}/edit" class="btn btn-sm btn-outline-secondary" title="Edit"><span class="material-symbols-outlined" style="font-size:18px">edit</span></a>
                <button class="btn btn-sm btn-outline-danger" data-confirm="Delete category '{{.Name}}'?" data-action="/api/v1/households/{{$.Household.ID}}/categories/{{.ID}}" data-method="DELETE" title="Delete"><span class="material-symbols-outlined" style="font-size:18px">delete</span></button>
            </td>
        </tr>
        {{end}}
    </tbody>
</table>
{{end}}

<hr class="mt-4">

<h3 class="text-danger">Danger Zone</h3>
<button class="btn btn-outline-danger btn-sm" data-confirm="Delete this household and all its data?" data-action="/api/v1/households/{{.Household.ID}}" data-method="DELETE" data-redirect="/">Delete Household</button>

<script>
(function() {
    var sel = document.getElementById('currency-select');
    var custom = document.getElementById('currency-custom');

    function toggle() {
        if (sel.value === 'CUSTOM') {
            custom.classList.remove('d-none');
            custom.setAttribute('name', 'currency');
            custom.required = true;
            sel.removeAttribute('name');
        } else {
            custom.classList.add('d-none');
            custom.removeAttribute('name');
            custom.required = false;
            sel.setAttribute('name', 'currency');
        }
    }

    sel.addEventListener('change', toggle);
    toggle();
})();
</script>
{{end}}
