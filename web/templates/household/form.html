{{define "content"}}
<h1>{{if .Household.ID}}Edit{{else}}New{{end}} Household</h1>

<form method="POST" action="{{if .Household.ID}}/households/{{.Household.ID}}{{else}}/households{{end}}" class="mt-3" style="max-width: 500px;">
    <div class="mb-3">
        <label for="name" class="form-label">Name</label>
        <input type="text" class="form-control" id="name" name="name" value="{{.Household.Name}}" required maxlength="100">
    </div>
    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <textarea class="form-control" id="description" name="description" rows="2" maxlength="500">{{.Household.Description}}</textarea>
    </div>
    <div class="mb-3">
        <label for="currency-select" class="form-label">Currency</label>
        <select class="form-select" id="currency-select" name="currency">
            {{$current := .Household.Currency}}
            {{$currencies := .Currencies}}
            {{range .Currencies}}
            <option value="{{.Code}}" {{if eq .Code $current}}selected{{end}}>{{.Code}} ({{.Symbol}}) — {{.Label}}</option>
            {{end}}
            <option value="CUSTOM" {{if not (isCurrencyCode $current $currencies)}}selected{{end}}>Custom…</option>
        </select>
        <input type="text" class="form-control mt-2 {{if isCurrencyCode $current $currencies}}d-none{{end}}" id="currency-custom" maxlength="3" pattern="[A-Z]{3}" placeholder="e.g. TRY" value="{{if not (isCurrencyCode $current $currencies)}}{{$current}}{{end}}">
    </div>

    {{template "icon_picker" dict "SelectedIcon" (or .Household.Icon "home") "Icons" .Icons}}

    <button type="submit" class="btn btn-primary">Save</button>
    <a href="/" class="btn btn-secondary">Cancel</a>
</form>

<script>
(function() {
    var sel = document.getElementById('currency-select');
    var custom = document.getElementById('currency-custom');

    function toggle() {
        if (sel.value === 'CUSTOM') {
            custom.classList.remove('d-none');
            custom.setAttribute('name', 'currency');
            custom.required = true;
            sel.removeAttribute('name');
        } else {
            custom.classList.add('d-none');
            custom.removeAttribute('name');
            custom.required = false;
            sel.setAttribute('name', 'currency');
        }
    }

    sel.addEventListener('change', toggle);
    toggle();
})();
</script>
{{end}}
